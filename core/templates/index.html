{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="panel-header bg-primary-gradient">
  <div class="page-inner py-5">
    <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
      <div>
        <h2 class="text-white pb-2 fw-bold">Dashboard</h2>
        <h5 class="text-white op-7 mb-2">Covid-19 Tracker</h5>
      </div>
      <div class="ml-md-auto py-2 py-md-0">
        <h3 class="text-white fw-bold">Latest Covid-19 stats</h3>
      </div>
    </div>
  </div>
</div>
<div class="page-inner mt--5">
  <div class="row mt--2">
    <div class="col-md-6">
      <div class="card full-height">
        <div class="card-body">
          <div class="card-title">Global Corona virus information</div>
          <div class="card-category">Today's Numbers</div>
          <div class="d-flex flex-wrap justify-content-around pb-2 pt-4">
            <div class="px-2 pb-2 pb-md-0 text-center">
              <div id="circles-10">
                <div class="circles-wrp" style="position: relative; display: inline-block;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="90" height="90">
                    <path fill="transparent" stroke="#f1f1f1" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 44.942357332570026 3.500040032273624 Z"
                      class="circles-maxValueStroke"></path>
                    <path fill="transparent" stroke="#FF9E27" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 20.644357636259837 78.60137921350231 "
                      class="circles-valueStroke"></path>
                  </svg>
                  <div class="circles-text"
                    style="position: absolute; top: 0px; left: 0px; text-align: center; width: 100%; font-size: 15px; height: 90px; line-height: 90px;">
                    {{world.total_confirmed}}
                  </div>
                </div>
              </div>
              <h6 class="fw-bold mt-3 mb-0">Confirmed</h6>
            </div>
            <div class="px-2 pb-2 pb-md-0 text-center">
              <div id="circles-20">
                <div class="circles-wrp" style="position: relative; display: inline-block;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="90" height="90">
                    <path fill="transparent" stroke="#f1f1f1" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 44.942357332570026 3.500040032273624 Z"
                      class="circles-maxValueStroke"></path>
                    <path fill="transparent" stroke="#2BB930" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 20.644357636259837 78.60137921350231 "
                      class="circles-valueStroke"></path>
                  </svg>
                  <div class="circles-text"
                    style="position: absolute; top: 0px; left: 0px; text-align: center; width: 100%; font-size: 15px; height: 90px; line-height: 90px;">
                    {{world.total_recovered}}
                  </div>
                </div>
              </div>
              <h6 class="fw-bold mt-3 mb-0">Recovered</h6>
            </div>
            <div class="px-2 pb-2 pb-md-0 text-center">
              <div id="circles-30">
                <div class="circles-wrp" style="position: relative; display: inline-block;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="90" height="90">
                    <path fill="transparent" stroke="#f1f1f1" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 44.942357332570026 3.500040032273624 Z"
                      class="circles-maxValueStroke"></path>
                    <path fill="transparent" stroke="#F25961" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 20.644357636259837 78.60137921350231 "
                      class="circles-valueStroke"></path>
                  </svg>
                  <div class="circles-text"
                    style="position: absolute; top: 0px; left: 0px; text-align: center; width: 100%; font-size: 15px; height: 90px; line-height: 90px;">
                    {{world.total_deaths}}
                  </div>
                </div>
              </div>
              <h6 class="fw-bold mt-3 mb-0">Deaths</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card full-height">
        <div class="card-body">
          <div class="card-title">Worldwide cases</div>
          <div class="row py-3">
            <div class="col-md-4 d-flex flex-column justify-content-around">
              <div>
                <h6 class="fw-bold text-uppercase text-success op-8">Newly Confirmed cases</h6>
                <h3 class="fw-bold">{{ world.newly_confirmed }}</h3>
              </div>
              <div>
                <h6 class="fw-bold text-uppercase text-danger op-8">Total Confirmed cases</h6>
                <h3 class="fw-bold">{{world.total_confirmed}}</h3>
              </div>
            </div>
            <div class="col-md-8">
              <div id="chart-container">
                <canvas id="totalIncomeChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt--2">
    <div class="col-md-6">
      <div class="card full-height">
        <div class="card-body">
          <div class="card-title fw-bold">Fatality rate</div>
          <div class="card-category fw-bold">Of total cases</div>
          <div class="d-flex flex-wrap justify-content-around pb-2 pt-4">
            <div class="px-2 pb-2 pb-md-0 text-center">
              <div id="circles-30">
                <div class="circles-wrp" style="position: relative; display: inline-block;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="90" height="90">
                    <path fill="transparent" stroke="#f1f1f1" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 44.942357332570026 3.500040032273624 Z"
                      class="circles-maxValueStroke">
                    </path>
                    <path fill="transparent" stroke="#F25961" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 20.644357636259837 78.60137921350231 "
                      class="circles-valueStroke">
                    </path>
                  </svg>
                  <div class="circles-text"
                    style="position: absolute; top: 0px; left: 0px; text-align: center; width: 100%; font-size: 15px; height: 90px; line-height: 90px;">
                    {{fatality_rate | floatformat}}%
                  </div>
                </div>
              </div>
              <h6 class="fw-bold mt-3 mb-0">Deaths</h6>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card full-height">
        <div class="card-body">
          <div class="card-title fw-bold">Recovery rate</div>
          <div class="card-category fw-bold">Of total cases</div>
          <div class="d-flex flex-wrap justify-content-around pb-2 pt-4">
            <div class="px-2 pb-2 pb-md-0 text-center">
              <div id="circles-30">
                <div class="circles-wrp" style="position: relative; display: inline-block;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="90" height="90">
                    <path fill="transparent" stroke="#f1f1f1" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 44.942357332570026 3.500040032273624 Z"
                      class="circles-maxValueStroke">
                    </path>
                    <path fill="transparent" stroke="#FF9E27" stroke-width="7"
                      d="M 44.99154756204665 3.500000860767564 A 41.5 41.5 0 1 1 20.644357636259837 78.60137921350231 "
                      class="circles-valueStroke">
                    </path>
                  </svg>
                  <div class="circles-text"
                    style="position: absolute; top: 0px; left: 0px; text-align: center; width: 100%; font-size: 15px; height: 90px; line-height: 90px;">
                    {{recovery_rate | floatformat}}%
                  </div>
                </div>
              </div>
              <h6 class="fw-bold mt-3 mb-0">Recovred</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <div class="card-head-row">
            <div class="card-title">Worldwide statistics for Corona Virus Patients</div>
            <div class="card-tools">
              <a href="#" class="btn btn-info btn-border btn-round btn-sm mr-2">
                <span class="btn-label">
                  <i class="fa fa-pencil"></i>
                </span>
                Export
              </a>
              <a href="#" class="btn btn-info btn-border btn-round btn-sm">
                <span class="btn-label">
                  <i class="fa fa-print"></i>
                </span>
                Print
              </a>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-container" style="min-height: 375px">
            <canvas id="statisticsChart"></canvas>
          </div>
          <div id="myChartLegend"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="row row-card-no-pd">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          <div class="card-head-row card-tools-still-right">
            <h4 class="card-title">Worldwide deaths due to Covid-19</h4>
            <div class="card-tools">
              <button class="btn btn-icon btn-link btn-primary btn-xs"><span class="fa fa-angle-down"></span></button>
              <button class="btn btn-icon btn-link btn-primary btn-xs btn-refresh-card"><span
                  class="fa fa-sync-alt"></span></button>
              <button class="btn btn-icon btn-link btn-primary btn-xs"><span class="fa fa-times"></span></button>
            </div>
          </div>
          <p class="card-category">
            Top 3 countries having most death count due to corona virus</p>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="table-responsive table-hover table-sales">
                <table class="table">
                  <tbody>
                    <tr>
                      <td>
                        <div class="flag">
                          <img src={{country1_code}} alt="indonesia">
                        </div>
                      </td>
                      <td>{{country1.country_name}}</td>
                      <td class="text-right">
                        {{country1.cases.total_deaths}}
                      </td>
                      <td class="text-right">
                        {{country1_deathRate | floatformat}}%
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="flag">
                          <img src={{country2_code}} alt="united states">
                        </div>
                      </td>
                      <td>{{country2.country_name}}</td>
                      <td class="text-right">
                        {{country2.cases.total_deaths}}
                      </td>
                      <td class="text-right">
                        {{country2_deathRate | floatformat}}%
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="flag">
                          <img src={{country3_code}} alt={{country3_code}}>
                        </div>
                      </td>
                      <td>{{country3.country_name}}</td>
                      <td class="text-right">
                        {{country3.cases.total_deaths}}
                      </td>
                      <td class="text-right">
                        {{country3_deathRate | floatformat}}%
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mapcontainer">
                <div id="map-example" class="vmap"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

{% endblock content %}

{% block javascripts %}

<script src="/static/assets/js/demo.js"></script>

<script>
  var world_cases = "{{ world | safe }}";
  world_cases = JSON.stringify(world_cases);
  world_cases = JSON.parse(world_cases);
  var cases = world_cases.split(",")
  var confirmed_Cases = parseInt((cases[0].split(":"))[1]);
  var recovered_Cases = parseInt((cases[1].split(":"))[1]);
  var death_Cases = parseInt((cases[2].split(":"))[1]);

  Circles.create({
    id: 'circles-1',
    radius: 45,
    value: 60,
    maxValue: 100,
    width: 7,
    text: confirmed_Cases,
    colors: ['#f1f1f1', '#FF9E27'],
    duration: 400,
    wrpClass: 'circles-wrp',
    textClass: 'circles-text',
    styleWrapper: true,
    styleText: true
  })

  Circles.create({
    id: 'circles-2',
    radius: 45,
    value: 70,
    maxValue: 100,
    width: 7,
    text: recovered_Cases,
    colors: ['#f1f1f1', '#2BB930'],
    duration: 280,
    wrpClass: 'circles-wrp',
    textClass: 'circles-text',
    fontSize: '15px',
    styleWrapper: true,
    styleText: true
  })

  Circles.create({
    id: 'circles-3',
    radius: 45,
    value: 40,
    maxValue: 100,
    width: 7,
    text: death_Cases,
    colors: ['#f1f1f1', '#F25961'],
    duration: 170,
    wrpClass: 'circles-wrp',
    textClass: 'circles-text',
    styleWrapper: true,
    styleText: true
  })

  var totalIncomeChart = document.getElementById('totalIncomeChart').getContext('2d');

  var d = new Date();
  var d1 = new Date();
  d1.setDate(d1.getDate() - 1);
  var d2 = new Date();
  d2.setDate(d2.getDate() - 2);
  var d3 = new Date();
  d3.setDate(d3.getDate() - 3);
  var d4 = new Date();
  d4.setDate(d4.getDate() - 4);
  var d6 = new Date();
  d6.setDate(d6.getDate() - 6);

  var mytotalIncomeChart = new Chart(totalIncomeChart, {
    type: 'bar',
    data: {
      labels: [d6.toISOString().slice(0, 10), "", d3.toISOString().slice(0, 10), "", "", d.toISOString().slice(0, 10)],
      datasets: [{
        label: "Total Cases",
        backgroundColor: '#ff9e27',
        borderColor: 'rgb(23, 125, 255)',
        data: [(confirmed_Cases - 300017), (confirmed_Cases - 230000), (confirmed_Cases - 200451), (confirmed_Cases - 157036), (confirmed_Cases - 109034), confirmed_Cases],
      }],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        display: false,
      },
      scales: {
        yAxes: [{
          ticks: {
            display: false //this will remove only the label
          },
          gridLines: {
            drawBorder: false,
            display: false
          }
        }],
        xAxes: [{
          gridLines: {
            drawBorder: false,
            display: false
          }
        }]
      },
    }
  });

  var ctx = document.getElementById('statisticsChart').getContext('2d');

  var statisticsChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [d4.toISOString().slice(0, 10), d3.toISOString().slice(0, 10), d2.toISOString().slice(0, 10), d1.toISOString().slice(0, 10), d.toISOString().slice(0, 10)],
      datasets: [{
        label: "Cases",
        borderColor: '#f3545d',
        pointBackgroundColor: 'rgba(243, 84, 93, 0.6)',
        pointRadius: 0,
        backgroundColor: 'rgba(243, 84, 93, 0.4)',
        legendColor: '#f3545d',
        fill: true,
        borderWidth: 2,
        data: [(confirmed_Cases - 230000), (confirmed_Cases - 200451), (confirmed_Cases - 157036), (confirmed_Cases - 109034), confirmed_Cases]
      }, {
        label: "Recovered",
        borderColor: '#fdaf4b',
        pointBackgroundColor: 'rgba(253, 175, 75, 0.6)',
        pointRadius: 0,
        backgroundColor: 'rgba(253, 175, 75, 0.4)',
        legendColor: '#fdaf4b',
        fill: true,
        borderWidth: 2,
        data: [(recovered_Cases - 230000), (recovered_Cases - 200451), (recovered_Cases - 157036), (recovered_Cases - 109034), recovered_Cases]
      }, {
        label: "Deaths",
        borderColor: '#177dff',
        pointBackgroundColor: 'rgba(23, 125, 255, 0.6)',
        pointRadius: 0,
        backgroundColor: 'rgba(23, 125, 255, 0.4)',
        legendColor: '#177dff',
        fill: true,
        borderWidth: 2,
        data: [(death_Cases - 215000), (death_Cases - 200451), (death_Cases - 157036), (death_Cases - 109034), death_Cases]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        display: false
      },
      tooltips: {
        bodySpacing: 4,
        mode: "nearest",
        intersect: 0,
        position: "nearest",
        xPadding: 10,
        yPadding: 10,
        caretPadding: 10
      },
      layout: {
        padding: { left: 5, right: 5, top: 15, bottom: 15 }
      },
      scales: {
        yAxes: [{
          ticks: {
            fontStyle: "500",
            beginAtZero: false,
            maxTicksLimit: 5,
            padding: 10
          },
          gridLines: {
            drawTicks: false,
            display: false
          }
        }],
        xAxes: [{
          gridLines: {
            zeroLineColor: "transparent"
          },
          ticks: {
            padding: 10,
            fontStyle: "500"
          }
        }]
      },
      legendCallback: function (chart) {
        var text = [];
        text.push('<ul class="' + chart.id + '-legend html-legend">');
        for (var i = 0; i < chart.data.datasets.length; i++) {
          text.push('<li><span style="background-color:' + chart.data.datasets[i].legendColor + '"></span>');
          if (chart.data.datasets[i].label) {
            text.push(chart.data.datasets[i].label);
          }
          text.push('</li>');
        }
        text.push('</ul>');
        return text.join('');
      }
    }
  });

  var myLegendContainer = document.getElementById("myChartLegend");

  // generate HTML legend
  myLegendContainer.innerHTML = statisticsChart.generateLegend();

  // bind onClick event to all LI-tags of the legend
  var legendItems = myLegendContainer.getElementsByTagName('li');
  for (var i = 0; i < legendItems.length; i += 1) {
    legendItems[i].addEventListener("click", legendClickCallback, false);
  }

  $('#lineChart').sparkline([105, 103, 123, 100, 95, 105, 115], {
    type: 'line',
    height: '70',
    width: '100%',
    lineWidth: '2',
    lineColor: '#ffa534',
    fillColor: 'rgba(255, 165, 52, .14)'
  });
</script>

{% endblock javascripts %}